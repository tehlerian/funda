<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crypto Fundamental Dashboard ‚Äî Single File</title>

  <!-- Tailwind CDN (for quick styling) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* –ú–∞–ª–∫–æ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Å—Ç–∏–ª–æ–≤–µ, –∑–∞ –¥–∞ –ø—Ä–∏–ª–∏—á–∞ –Ω–∞ trade4 */
    body { background:#f3f4f6; }
    .table-head { background:#f8fafc; }
    .indicator { width:18px; height:18px; display:inline-block; border-radius:4px; }
    .cell-ellipsis { max-width:280px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .btn { @apply px-3 py-1 rounded text-sm; }
  </style>
</head>
<body class="font-sans">

  <!-- NAV / CONTROLS -->
  <nav class="bg-white shadow p-4 mb-6">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <div class="text-xl font-bold text-blue-600">Crypto Fundamentals</div>
        <div class="text-sm text-gray-600">–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî Top 100/200</div>
      </div>
      <div class="flex items-center space-x-2">
        <button id="reloadBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:opacity-90">–ü—Ä–µ–∑–∞—Ä–µ–¥–∏</button>
        <button id="loadTopBtn" class="px-4 py-2 bg-green-500 text-white rounded hover:opacity-90">–ó–∞—Ä–µ–¥–∏ Top 200</button>
        <button id="csvBtn" class="px-4 py-2 bg-gray-600 text-white rounded hover:opacity-90">–°–≤–∞–ª–∏ CSV</button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 pb-12">
    <!-- TABLE VIEW -->
    <section id="listView">
      <div class="bg-white shadow rounded-xl p-4">
        <div class="flex items-center justify-between mb-4">
          <h1 class="text-lg font-semibold">–¢–æ–ø –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—É—Ç–∏ ‚Äî –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª–µ–Ω –∏–∑–≥–ª–µ–¥</h1>
          <div class="text-sm text-gray-500">–ü–æ–¥—Ä–µ–¥–∏ –ø–æ: <span id="currentSort" class="font-medium">–°–∏–≥–Ω–∞–ª–µ–Ω –∏–Ω–¥–µ–∫—Å (‚Üì)</span></div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full table-auto border-collapse">
            <thead class="table-head">
              <tr>
                <th class="p-3 text-left cursor-pointer" data-sort="rank">#</th>
                <th class="p-3 text-left cursor-pointer" data-sort="name">–ò–º–µ</th>
                <th class="p-3 text-left cursor-pointer" data-sort="price">–¶–µ–Ω–∞ (USD)</th>
                <th class="p-3 text-left">–ù–æ–≤–∏–Ω–∏</th>
                <th class="p-3 text-left">–û–Ω—á–µ–π–Ω</th>
                <th class="p-3 text-left">–°–æ—Ü–∏–∞–ª–Ω–æ</th>
                <th class="p-3 text-left">–ú—Ä–µ–∂–∞</th>
                <th class="p-3 text-left cursor-pointer" data-sort="signal">–°–∏–≥–Ω–∞–ª–µ–Ω –∏–Ω–¥–µ–∫—Å</th>
                <th class="p-3 text-left">–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
                <th class="p-3 text-left">–î–µ—Ç–∞–π–ª–∏</th>
              </tr>
            </thead>
            <tbody id="coinsTbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- DETAIL VIEW -->
    <section id="detailView" class="hidden">
      <div class="bg-white shadow rounded-xl p-6">
        <div class="flex items-start justify-between">
          <div>
            <h2 id="detailTitle" class="text-2xl font-bold"></h2>
            <p id="detailSub" class="text-sm text-gray-600"></p>
          </div>
          <div class="space-x-2">
            <button id="backBtn" class="px-3 py-2 bg-gray-200 rounded hover:bg-gray-300">‚¨Ö –û–±—Ä–∞—Ç–Ω–æ</button>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <h3 class="font-semibold mb-2">üìà –û–Ω—á–µ–π–Ω –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç (–ø—Ä–∏–º–µ—Ä)</h3>
            <canvas id="onchainChart" class="w-full h-64 bg-white p-2 rounded border"></canvas>

            <div class="mt-6 grid grid-cols-2 gap-4">
              <div class="bg-gray-50 p-4 rounded border">
                <div class="text-sm text-gray-500">Active Addresses (7d avg)</div>
                <div id="detailActive" class="text-xl font-semibold mt-1">‚Äî</div>
              </div>
              <div class="bg-gray-50 p-4 rounded border">
                <div class="text-sm text-gray-500">–û–±–µ–º –∫—ä–º –±–æ—Ä—Å–∏ (24h)</div>
                <div id="detailFlows" class="text-xl font-semibold mt-1">‚Äî</div>
              </div>
            </div>

            <h3 class="font-semibold mt-6 mb-2">üì∞ –û—Ñ–∏—Ü–∏–∞–ª–Ω–∏ –Ω–æ–≤–∏–Ω–∏ (–ø—Ä–∏–º–µ—Ä)</h3>
            <ul id="detailNews" class="list-disc pl-5 text-sm text-gray-700"></ul>
          </div>

          <div class="">
            <div class="bg-gray-50 p-4 rounded border mb-4">
              <div class="text-sm text-gray-500">–¶–µ–Ω–∞</div>
              <div id="detailPrice" class="text-2xl font-bold mt-1">‚Äî</div>
              <div class="text-sm text-gray-500 mt-1">–°–∏–≥–Ω–∞–ª–µ–Ω –∏–Ω–¥–µ–∫—Å: <span id="detailSignal" class="font-semibold">‚Äî</span></div>
            </div>

            <div class="bg-gray-50 p-4 rounded border mb-4">
              <div class="text-sm text-gray-500">–°–æ—Ü–∏–∞–ª–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
              <div id="detailSocial" class="mt-2">‚Äî</div>
            </div>

            <div class="bg-gray-50 p-4 rounded border mb-4">
              <div class="text-sm text-gray-500">–ú—Ä–µ–∂–æ–≤–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç</div>
              <div id="detailNetwork" class="mt-2">‚Äî</div>
            </div>

            <div class="bg-gray-50 p-4 rounded border">
              <div class="text-sm text-gray-500">–ö–æ–º–µ–Ω—Ç–∞—Ä</div>
              <div id="detailComment" class="mt-2 text-sm text-gray-700"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

<script>
/* ========== MOCK DATA GENERATOR ========== */
const COLORS = {
  green: '#16a34a',
  red: '#dc2626',
  white: '#e6e7e9'
};

function colorClass(col) {
  if (col === 'green') return COLORS.green;
  if (col === 'red') return COLORS.red;
  return COLORS.white;
}

function rand(min, max) { return Math.floor(Math.random()*(max-min+1))+min; }

function genMockCoin(i) {
  const symbols = ['BTC','ETH','BNB','SOL','ADA','XRP','LTC','DOT','AVAX','LINK','MATIC','UNI','ATOM','ICP','FIL','TRX','EOS'];
  const symbol = symbols[i % symbols.length] + (i>symbols.length?i:'');
  const name = symbol + ' Coin';
  const price = Math.round((Math.random()*60000 + 10) * 100)/100;
  const news = ['green','red','white'][Math.floor(Math.random()*3)];
  const onchain = ['green','red','white'][Math.floor(Math.random()*3)];
  const social = ['green','red','white'][Math.floor(Math.random()*3)];
  const network = ['green','red','white'][Math.floor(Math.random()*3)];
  const signal = ( (news==='green'?1:news==='red'?-1:0)*0.35 +
                   (onchain==='green'?1:onchain==='red'?-1:0)*0.30 +
                   (social==='green'?1:social==='red'?-1:0)*0.20 +
                   (network==='green'?1:network==='red'?-1:0)*0.15 );
  const signalIndex = Math.round(signal * 100)/100;
  const comment = (news==='green'?'Good news. ':news==='red'?'Negative news. ':'') + 'Onchain: ' + onchain + '.';
  const newsFeed = [
    {title: `${name} ‚Äî –Ω–æ–≤–∏–Ω–∞ ${rand(1,99)}`, link:'#'},
    {title: `${name} ‚Äî –ø–∞—Ä—Ç–Ω—å–æ—Ä—Å—Ç–≤–æ –æ–±—è–≤–µ–Ω–æ`, link:'#'}
  ];
  const onchainData = Array.from({length:14}).map((_,k)=>({date: k, value: Math.max(100, Math.round(price/10 + Math.random()*5000))}));
  return {
    id: 'c'+i,
    symbol,
    name,
    price,
    news, onchain, social, network,
    signalIndex, comment, newsFeed, onchainData
  };
}

/* ========== STATE ========== */
let coins = [];
let currentSort = {key:'signal', desc:true};

/* ========== RENDER TABLE ========== */
const tbody = document.getElementById('coinsTbody');

function renderTable() {
  tbody.innerHTML = '';
  // sort
  const arr = [...coins].sort((a,b)=>{
    if (currentSort.key === 'signal') {
      return currentSort.desc ? b.signalIndex - a.signalIndex : a.signalIndex - b.signalIndex;
    }
    if (currentSort.key === 'name') {
      return currentSort.desc ? b.name.localeCompare(a.name) : a.name.localeCompare(b.name);
    }
    if (currentSort.key === 'price') {
      return currentSort.desc ? b.price - a.price : a.price - b.price;
    }
    return 0;
  });

  arr.forEach((coin, idx) => {
    const tr = document.createElement('tr');
    tr.className = 'border-t hover:bg-gray-50';
    tr.innerHTML = `
      <td class="p-3 align-top">${idx+1}</td>
      <td class="p-3 align-top font-medium">${coin.name} <span class="text-xs text-gray-500">(${coin.symbol})</span></td>
      <td class="p-3 align-top">$${coin.price.toLocaleString()}</td>
      <td class="p-3 align-top"><span class="indicator" style="background:${colorClass(coin.news)}"></span></td>
      <td class="p-3 align-top"><span class="indicator" style="background:${colorClass(coin.onchain)}"></span></td>
      <td class="p-3 align-top"><span class="indicator" style="background:${colorClass(coin.social)}"></span></td>
      <td class="p-3 align-top"><span class="indicator" style="background:${colorClass(coin.network)}"></span></td>
      <td class="p-3 align-top font-semibold">${coin.signalIndex >= 0 ? '+' + coin.signalIndex.toFixed(2) : coin.signalIndex.toFixed(2)}</td>
      <td class="p-3 align-top cell-ellipsis" title="${coin.comment}">${coin.comment}</td>
      <td class="p-3 align-top"><a href="#coin/${coin.id}" class="text-blue-600 underline">–ü–æ–≤–µ—á–µ</a></td>
    `;
    tbody.appendChild(tr);
  });
}

/* ========== CONTROLS ========== */
document.getElementById('reloadBtn').addEventListener('click', ()=> { renderTable(); flashMsg('–û–±–Ω–æ–≤–µ–Ω–æ'); });
document.getElementById('loadTopBtn').addEventListener('click', ()=> { loadTopN(200); flashMsg('–ó–∞—Ä–µ–¥–µ–Ω–∏ Top 200 (mock)'); });
document.getElementById('csvBtn').addEventListener('click', downloadCSV);

function flashMsg(text) {
  const el = document.createElement('div');
  el.textContent = text;
  el.className = 'fixed right-6 bottom-6 bg-black text-white px-4 py-2 rounded shadow';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),1500);
}

/* ========== SORTING ON HEADERS ========== */
document.querySelectorAll('th[data-sort]').forEach(th=>{
  th.addEventListener('click', ()=>{
    const keyMap = { 'rank':'rank', 'name':'name', 'price':'price', 'signal':'signal' };
    const key = th.getAttribute('data-sort');
    // toggle
    if ( (key==='name' && currentSort.key==='name') || (key==='price' && currentSort.key==='price') || (key==='signal' && currentSort.key==='signal') ) {
      currentSort.desc = !currentSort.desc;
    } else {
      currentSort.key = key === 'rank' ? 'signal' : key; // rank sorts by signal default
      currentSort.desc = true;
    }
    document.getElementById('currentSort').textContent = (currentSort.key==='signal' ? '–°–∏–≥–Ω–∞–ª–µ–Ω –∏–Ω–¥–µ–∫—Å' : currentSort.key.charAt(0).toUpperCase()+currentSort.key.slice(1)) + (currentSort.desc ? ' (‚Üì)' : ' (‚Üë)');
    renderTable();
  });
});

/* ========== CSV EXPORT ========== */
function downloadCSV() {
  const headers = ['rank','symbol','name','price','news','onchain','social','network','signalIndex','comment'];
  const rows = coins.map((c,idx)=>[idx+1,c.symbol,c.name,c.price,c.news,c.onchain,c.social,c.network,c.signalIndex,c.comment]);
  const csv = [headers.join(','), ...rows.map(r=>r.map(v=>`"${(''+v).replace(/\"/g,'""')}"`).join(','))].join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'crypto_fundamentals.csv';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

/* ========== LOAD TOP N (mock) ========== */
function loadTopN(n=100) {
  coins = [];
  for (let i=0;i<n;i++) coins.push(genMockCoin(i+1));
  renderTable();
}

/* ========== ROUTING: HASH (list <-> detail) ========== */
window.addEventListener('hashchange', handleHash);
function handleHash() {
  const hash = location.hash.replace(/^#\/?/, '');
  if (!hash) { showList(); return; }
  const parts = hash.split('/');
  if (parts[0] === 'coin' && parts[1]) {
    showDetail(parts[1]);
  } else {
    showList();
  }
}

function showList() {
  document.getElementById('detailView').classList.add('hidden');
  document.getElementById('listView').classList.remove('hidden');
  location.hash = ''; // normalize
}

document.getElementById('backBtn').addEventListener('click', () => { showList(); });

/* ========== DETAIL PAGE ========== */
let chartInstance = null;

function showDetail(id) {
  const coin = coins.find(c=>c.id===id);
  if (!coin) { alert('–ú–æ–Ω–µ—Ç–∞—Ç–∞ –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω–∞'); showList(); return; }

  document.getElementById('listView').classList.add('hidden');
  document.getElementById('detailView').classList.remove('hidden');

  document.getElementById('detailTitle').textContent = coin.name + ' ('+coin.symbol+')';
  document.getElementById('detailSub').textContent = '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª–µ–Ω –∑–∞–ø–∏—Å ‚Äî –ò–Ω–¥–µ–∫—Å: ' + (coin.signalIndex >= 0 ? '+' + coin.signalIndex.toFixed(2) : coin.signalIndex.toFixed(2));
  document.getElementById('detailPrice').textContent = '$' + coin.price.toLocaleString();
  document.getElementById('detailSignal').textContent = (coin.signalIndex >= 0 ? '+' + coin.signalIndex.toFixed(2) : coin.signalIndex.toFixed(2));
  document.getElementById('detailActive').textContent = Math.round(coin.onchainData.reduce((s,d)=>s+d.value,0)/coin.onchainData.length).toLocaleString();
  document.getElementById('detailFlows').textContent = '$' + (rand(100000,500000)).toLocaleString();
  document.getElementById('detailSocial').textContent = coin.social.toUpperCase();
  document.getElementById('detailNetwork').textContent = coin.network.toUpperCase();
  document.getElementById('detailComment').textContent = coin.comment;

  const newsList = document.getElementById('detailNews');
  newsList.innerHTML = '';
  coin.newsFeed.forEach(n=>{
    const li = document.createElement('li');
    li.innerHTML = `<a href="${n.link}" target="_blank" rel="noreferrer" class="text-blue-600 underline">${n.title}</a>`;
    newsList.appendChild(li);
  });

  // Chart
  const ctx = document.getElementById('onchainChart').getContext('2d');
  const labels = coin.onchainData.map(d => 'D' + d.date);
  const data = coin.onchainData.map(d => d.value);
  if (chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Active addresses',
        data,
        borderColor: '#2563eb',
        backgroundColor: 'rgba(37,99,235,0.08)',
        fill: true,
        tension: 0.2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: { y: { beginAtZero: false } }
    }
  });
}

/* ========== INIT ========== */
(function init() {
  loadTopN(100); // initial load
  // handle initial hash
  handleHash();
})();
</script>
</body>
</html>
